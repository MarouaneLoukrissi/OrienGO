<!-- Loading State -->
<div *ngIf="isLoading" class="flex items-center justify-center h-screen">
  <div class="text-center">
    <div class="mx-auto animate-spin rounded-full h-32 w-32 border-b-4 border-orange-500 border-t-transparent"></div>
    <p class="mt-4 text-gray-600 text-lg">Loading coach profile...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="min-h-screen bg-orange-50 flex items-center justify-center">
  <div class="text-center">
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md">
      <svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
      <h3 class="mt-2 text-lg font-medium text-red-800">Error Loading Profile</h3>
      <p class="mt-1 text-sm text-red-600">{{ error }}</p>
      <button (click)="ngOnInit()" class="mt-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
        Try Again
      </button>
    </div>
  </div>
</div>

<!-- Main Profile Content -->
<div *ngIf="!isLoading && !error && coachProfile" class="min-h-screen bg-orange-50 pb-10 md:p-6 lg:p-8">
  <div class="max-w-[88rem] mx-auto">

    <!-- Profile Header -->
    <div class="bg-white md:rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      
      <!-- Container MUST be relative -->
      <div class="relative">

        <!-- Cover Photo Section -->
        <div class="bg-gradient-to-r from-orange-400 to-orange-500 h-48 overflow-hidden"
            [style.background-image]="coverPhoto ? 'url(' + coverPhoto + ')' : null"
            [style.background-size]="'cover'"
            [style.background-position]="'center'">

          <!-- Cover Photo Upload Button - Only show if isOwner -->
          <div *ngIf="isOwner" class="absolute top-4 right-4 z-5 xs:top-auto xs:bottom-4">
            <button
              class="bg-white bg-opacity-95 hover:bg-opacity-100 text-gray-800 px-2 py-1.5 md-up:px-5 md-up:py-2 rounded-lg font-semibold flex items-center gap-2 transition-all duration-200 text-sm md:text-base shadow-xl hover:shadow-2xl border border-gray-200 hover:scale-105"
              [disabled]="isUploadingCoverPhoto"
              (click)="coverPhotoInput.click()">
              <div *ngIf="isUploadingCoverPhoto" class="animate-spin w-4 h-4 border-2 border-gray-800 border-t-transparent rounded-full"></div>
              <svg *ngIf="!isUploadingCoverPhoto" class="w-6 h-6 md-up:w-6 md-up:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <span class="hidden md-up:block">{{ isUploadingCoverPhoto ? 'Uploading...' : 'Add Cover Photo' }}</span>
            </button>
            <input
              #coverPhotoInput
              type="file"
              accept="image/*"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              [disabled]="isUploadingCoverPhoto"
              (change)="onCoverPhotoChange($event)">
          </div>
        </div>

        <!-- Profile Photo Section -->
        <div class="absolute bottom-[-80px] left-1/2 -translate-x-1/2 md-up:left-10 md-up:translate-x-0 z-10">
          <div class="w-32 h-32 xxs:w-34 xxs:h-34 xs:w-36 xs:h-36 smaller:w-40 smaller:h-40 rounded-full border-[5px] border-white overflow-hidden bg-white relative">
            <img *ngIf="profileLoaded; else loadingTemplate"
              [src]="profilePicture || 'https://www.shutterstock.com/image-vector/blank-avatar-photo-place-holder-600nw-1095249842.jpg'"
              [alt]="getFullName() + ' profile picture'"
              class="w-full h-full object-cover" />

            <ng-template #loadingTemplate>
              <div class="absolute inset-0 flex items-center justify-center bg-white">
                <!-- Spinner -->
                <div class="w-8 h-8 xs:w-10 xs:h-10 border-4 border-gray-300 border-t-orange-500 rounded-full animate-spin"></div>
              </div>
            </ng-template>

            
            <!-- Camera Icon for Profile Picture - Only show if isOwner -->
            <div *ngIf="isOwner" class="fixed bottom-2 right-2 md:bottom-2 md:right-2 z-20">
              <button
                class="bg-orange-500 hover:bg-orange-600 text-white rounded-full p-2 shadow-xl transition-all duration-200 hover:scale-110"
                (click)="profilePictureInput.click()">
                <svg class="w-5 h-5 xs:w-6 xs:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.2">
                  <path stroke-linecp="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
              </button>
              <input
                #profilePictureInput
                type="file"
                accept="image/*"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                (change)="onProfilePictureChange($event)">
            </div>
          </div>
        </div>
      </div>

      <div class="px-3 xs:px-8 pt-60 md-up:pt-40 pb-6">
        <div class="flex flex-col md-lg:flex-row items-center text-center md-up:text-left md-up:items-start md-lg:items-end gap-4 md:gap-6 -mt-36">
          <!--Profile Info -->
          <div class="flex-1 md-up:pl-[175px]">
            <h1 class="text-2xl smaller:text-3xl md:text-4xl font-bold text-gray-900 mb-2 no-wrap">{{ getFullName() }}</h1>
            <!-- Location under name -->
            <div *ngIf="getLocationDisplay()" class="flex gap-2 text-gray-500 mb-2 items-center justify-center md-up:justify-start">
              <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <span class="text-sm md:text-base">{{ getLocationDisplay() }}</span>
            </div>
            <div class="flex gap-2 text-gray-600 mb-2 items-center justify-center md-up:justify-start">
              <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span class="text-sm md:text-base">Professional Coach</span>
            </div>
            <div class="flex flex-wrap gap-4 text-gray-500 text-sm mb-3 justify-center md-up:justify-start">
              <div class="flex gap-1 items-center">
                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span class="text-sm md:text-base text-left">{{ coachProfile.age }} years old</span>
              </div>
              <div class="flex gap-1 items-center">
                <svg class="w-5 h-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span class="text-sm md:text-base text-left">{{ getGenderDisplay(coachProfile.gender) }}</span>
              </div>
            </div>
            <p class="flex flex-wrap gap-4 text-orange-500 font-medium text-sm md:text-base justify-center md-up:justify-start">Available for coaching</p>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-wrap md:no-wrap gap-3 w-full md:w-auto md-up:pl-[175px] md-lg:pl-0">
            <button *ngIf="!isOwner && canSendMessage()" class="text-sm xs:text-base bg-orange-500 hover:bg-orange-600 text-white px-1 xs:px-4 lg:px-6 py-2 border border-orange-500 hover:border-orange-600 md:py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2 flex-1 md:flex-none justify-center">
              <svg class="w-4 h-4 xs:w-5 xs:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
              </svg>
              Connect
            </button>
            <button *ngIf="!isOwner && canSendMessage()" class="text-sm xs:text-base bg-orange-500 hover:bg-orange-600 text-white px-1 xs:px-4 lg:px-6 py-2 border border-orange-500 hover:border-orange-600 md:py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2 flex-1 md:flex-none justify-center">
              <svg class="shrink-0 w-4 h-4 xs:w-5 xs:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              Book Session
            </button>
            <button *ngIf="!isOwner && canSendMessage()" class="text-sm xs:text-base bg-white hover:bg-orange-50 text-orange-500 border border-orange-300 px-1 xs:px-4 lg:px-6 py-2 md:py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2 flex-1 md:flex-none justify-center">
              <svg class="w-4 h-4 xs:w-6 xs:h-6" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.0306 5.565C16.4236 4.94951 15.6676 5.28261 15.6676 5.28261L0.335205 11.729L6.95782 14.4811L12.6328 9.9027L7.97659 15.514L10.6373 22.1739L17.2942 6.93181C17.2942 6.93181 17.6377 6.18049 17.0306 5.565Z" fill="currentColor"/>
              </svg>
              Message
            </button>
            <button 
              (click)="onShareProfile()"
              class="text-sm xs:text-base bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 px-1 xs:px-4 lg:px-6 py-2 md:py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2 flex-1 md:flex-none justify-center">
              <svg class="w-3 h-4 xs:w-4 xs:h-5" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.50016 9.00008C5.50016 10.1507 4.56742 11.0834 3.41683 11.0834C2.26624 11.0834 1.3335 10.1507 1.3335 9.00008C1.3335 7.8495 2.26624 6.91675 3.41683 6.91675C4.56742 6.91675 5.50016 7.8495 5.50016 9.00008Z" stroke="#4C5564" stroke-width="1.6"/>
                <path d="M9.66667 4.41675L5.5 7.33341" stroke="#4C5564" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M9.66667 13.5834L5.5 10.6667" stroke="#4C5564" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M13.8337 14.4166C13.8337 15.5672 12.9009 16.4999 11.7503 16.4999C10.5997 16.4999 9.66699 15.5672 9.66699 14.4166C9.66699 13.266 10.5997 12.3333 11.7503 12.3333C12.9009 12.3333 13.8337 13.266 13.8337 14.4166Z" stroke="#4C5564" stroke-width="1.6"/>
                <path d="M13.8337 3.58333C13.8337 4.73393 12.9009 5.66667 11.7503 5.66667C10.5997 5.66667 9.66699 4.73393 9.66699 3.58333C9.66699 2.43274 10.5997 1.5 11.7503 1.5C12.9009 1.5 13.8337 2.43274 13.8337 3.58333Z" stroke="#4C5564" stroke-width="1.6"/>
              </svg>
              Share
            </button>
            <button *ngIf="isOwner" class="text-sm xs:text-base bg-orange-500 hover:bg-orange-600 text-white px-1 xs:px-4 lg:px-6 py-2 md:py-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2 flex-1 md:flex-none justify-center" (click)="onModifyProfile()">
              <svg class="shrink-0 w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Edit Profile
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6 mx-2 smaller:mx-3 sm:mx-5 md:mx-0">
      <!-- Loading state for stats -->
      <ng-container *ngIf="isLoadingStats">
        <div *ngFor="let i of [1,2,3,4]" class="bg-white rounded-xl p-1 xxs:p-3 xs:p-4 md:p-6 shadow-sm border border-gray-100 animate-pulse">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 md:w-14 md:h-14 rounded-lg bg-gray-200 shrink-0"></div>
            <div class="flex-1">
              <div class="h-6 md:h-8 bg-gray-200 rounded mb-2"></div>
              <div class="h-3 md:h-4 bg-gray-200 rounded w-3/4"></div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Dynamic Stats Cards -->
      <ng-container *ngIf="!isLoadingStats">
        <div *ngFor="let stat of stats" class="bg-white rounded-xl p-1 xxs:p-3 xs:p-4 md:p-6 shadow-sm border border-gray-100">
          <div class="flex items-center gap-3">
            <div [class]="'w-10 h-10 md:w-14 md:h-14 rounded-lg flex items-center justify-center shrink-0 ' + stat.bgColor">
              <svg class="w-7 h-7 md:w-10 md:h-10 shrink-0" [class]="stat.iconColor" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="stat.iconPath"></path>
              </svg>
            </div>
            <div>
              <div class="text-base xxs:text-xl md:text-2xl font-bold text-gray-900 whitespace-nowrap">{{ stat.value }}</div>
              <div class="text-[11px] xxs:text-xs md:text-sm text-gray-500 xs:whitespace-nowrap">{{ stat.label }}</div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6 mx-2 smaller:mx-3 sm:mx-5 md:mx-0">
      <!-- Personal Information / About Section -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl p-2 smaller:p-4 shadow-sm border border-gray-100" [ngClass]="{'md:p-9':isOwner,'md:p-11':!isOwner}">
          <div class="flex flex-col xs:flex-row items-start xs:items-center justify-between mb-6 gap-4">
            <h2 class="text-lg md:text-xl font-semibold text-gray-900">
              {{ isOwner ? 'Personal Information' : 'About' }}
            </h2>
            <button
              *ngIf="isOwner"
              class="text-orange-500 hover:text-orange-600 font-medium px-4 py-2 rounded-lg border border-orange-200 hover:bg-orange-50 transition-colors duration-200 text-sm md:text-base"
              (click)="onModifyProfile()">
              <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Modify
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-full">
            <div class="space-y-4">
              <!-- Dynamic Personal Information Fields -->
              <div *ngFor="let field of displayablePersonalFields.slice(0, Math.ceil(displayablePersonalFields.length/2))" class="flex items-start gap-3">
                <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getIconSvg(field.icon)"></path>
                </svg>
                <div>
                  <div class="text-sm text-gray-500 mb-1">{{ field.label }}</div>
                  <div class="text-gray-900 font-medium" [class.break-words]="field.key === 'email'">{{ field.value }}</div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <!-- Remaining Personal Information Fields -->
              <div *ngFor="let field of displayablePersonalFields.slice(Math.ceil(displayablePersonalFields.length/2))" class="flex items-start gap-3">
                <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getIconSvg(field.icon)"></path>
                </svg>
                <div>
                  <div class="text-sm text-gray-500 mb-1">{{ field.label }}</div>
                  <div class="text-gray-900 font-medium" [class.break-words]="field.key === 'email'">{{ field.value }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Coaching Expertise Section -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-lg md:text-xl font-semibold text-gray-900">Coaching Expertise</h2>
            <button
              *ngIf="isOwner"
              class="text-orange-500 hover:text-orange-600 font-medium px-3 py-1 rounded-lg border border-orange-200 hover:bg-orange-50 transition-colors duration-200 text-sm"
              (click)="onManageExpertise()">
              {{ hasExpertiseData ? 'Modify' : 'Add' }}
            </button>
          </div>

          <!-- Display expertise if exists -->
          <div *ngIf="hasExpertiseData">
            <!-- Expertise List -->
            <div *ngIf="expertiseList.length > 0" class="space-y-4 mb-6">
              <div *ngFor="let expertise of expertiseList" class="flex items-center gap-3">
                <div class="w-3 h-3 bg-orange-500 rounded-full flex-shrink-0"></div>
                <span class="text-gray-700 text-sm">{{ expertise }}</span>
              </div>
            </div>

            <!-- Services and Availability -->
            <div *ngIf="coachProfile.services || coachProfile.availability" class="mt-6 p-4 bg-orange-50 rounded-lg">
              <div *ngIf="coachProfile.services">
                <h3 class="font-medium text-gray-900 mb-2">Services</h3>
                <p class="text-sm text-gray-600 mb-3">{{ coachProfile.services }}</p>
              </div>
              <div *ngIf="coachProfile.availability">
                <h3 class="font-medium text-gray-900 mb-2">Availability</h3>
                <p class="text-sm text-gray-600 whitespace-pre-line">{{ coachProfile.availability }}</p>
              </div>
            </div>
          </div>

          <!-- Empty state -->
          <div *ngIf="!hasExpertiseData" class="text-center py-8">
            <div class="text-gray-400 mb-4">
              <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
              </svg>
            </div>
            <h3 class="text-sm font-medium text-gray-900 mb-1">No expertise added yet</h3>
            <p class="text-sm text-gray-500">{{ isOwner ? 'Add your coaching expertise and availability' : 'Coaching expertise not specified' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Dominant Profile Card - Full width -->
    <div class="mt-6 mx-2 smaller:mx-3 sm:mx-5 md:mx-0">
      <div class="bg-white rounded-xl p-6 md:p-8 shadow-sm border border-gray-100">
        <h2 class="text-lg md:text-xl font-semibold text-gray-900 mb-6">Dominant Profile of my coachees</h2>
        
        <!-- Loading state -->
        <div *ngIf="isLoadingDominantProfile" class="flex flex-col items-center text-center animate-pulse">
          <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-200 mb-4"></div>
          <div class="h-6 bg-gray-200 rounded w-32 mb-2"></div>
          <div class="h-4 bg-gray-200 rounded w-48 mb-6"></div>
          <div class="w-full max-w-md">
            <div class="h-4 bg-gray-200 rounded w-20 mb-2"></div>
            <div class="w-full bg-gray-200 rounded-full h-3"></div>
          </div>
        </div>

        <!-- Dynamic content -->
        <div *ngIf="!isLoadingDominantProfile && dominantProfile" class="flex flex-col items-center text-center">
          <!-- Target Icon -->
          <div class="w-16 h-16 md:w-20 md:h-20 px-2.5 py-2.5 md:px-3 md:py-3 rounded-full bg-orange-100 flex items-center justify-center mb-4">
            <svg class="w-34 h-34 md:w-56 md:h-56" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.9998 0.166504C19.2861 0.166504 14.6781 1.5643 10.7588 4.18314C6.83939 6.80199 3.78461 10.5242 1.98072 14.8792C0.176831 19.2342 -0.295149 24.0263 0.624465 28.6495C1.54408 33.2727 3.81399 37.5194 7.14714 40.8526C10.4803 44.1857 14.727 46.4556 19.3502 47.3752C23.9734 48.2948 28.7655 47.8229 33.1205 46.019C37.4754 44.2151 41.1977 41.1603 43.8165 37.2409C46.4354 33.3216 47.8332 28.7136 47.8332 23.9998C47.8257 17.6811 45.3123 11.6234 40.8443 7.15536C36.3763 2.68736 30.3186 0.173958 23.9998 0.166504ZM23.9998 43.4998C20.1431 43.4998 16.373 42.3562 13.1662 40.2135C9.95947 38.0708 7.46011 35.0253 5.9842 31.4622C4.50829 27.899 4.12212 23.9782 4.87454 20.1956C5.62695 16.4129 7.48414 12.9384 10.2113 10.2113C12.9384 7.48413 16.413 5.62694 20.1956 4.87452C23.9782 4.12211 27.899 4.50828 31.4622 5.98419C35.0253 7.4601 38.0708 9.95946 40.2135 13.1662C42.3562 16.373 43.4999 20.1431 43.4999 23.9998C43.4935 29.1696 41.4371 34.1259 37.7815 37.7815C34.1259 41.4371 29.1696 43.4935 23.9998 43.4998ZM23.9998 7.74984C20.7859 7.74984 17.6441 8.70288 14.9718 10.4885C12.2995 12.274 10.2167 14.8119 8.9868 17.7812C7.75688 20.7505 7.43508 24.0179 8.06209 27.1701C8.6891 30.3222 10.2368 33.2177 12.5094 35.4903C14.782 37.7629 17.6774 39.3106 20.8296 39.9376C23.9818 40.5646 27.2492 40.2428 30.2185 39.0129C33.1878 37.783 35.7257 35.7002 37.5112 33.0279C39.2968 30.3556 40.2499 27.2138 40.2499 23.9998C40.2453 19.6915 38.5317 15.5609 35.4853 12.5144C32.4388 9.46795 28.3082 7.75443 23.9998 7.74984ZM23.9998 35.9165C21.643 35.9165 19.339 35.2176 17.3793 33.9082C15.4196 32.5988 13.8922 30.7376 12.9903 28.5602C12.0883 26.3827 11.8523 23.9866 12.3122 21.675C12.772 19.3634 13.9069 17.2401 15.5735 15.5735C17.2401 13.9069 19.3634 12.772 21.675 12.3121C23.9866 11.8523 26.3827 12.0883 28.5602 12.9903C30.7376 13.8922 32.5988 15.4196 33.9082 17.3793C35.2176 19.339 35.9165 21.6429 35.9165 23.9998C35.9131 27.1593 34.6565 30.1883 32.4224 32.4224C30.1883 34.6565 27.1593 35.9131 23.9998 35.9165ZM23.9998 15.3332C22.2857 15.3332 20.6101 15.8415 19.1849 16.7938C17.7597 17.7461 16.6489 19.0996 15.9929 20.6832C15.3369 22.2669 15.1653 24.0095 15.4997 25.6906C15.8341 27.3718 16.6595 28.916 17.8716 30.1281C19.0836 31.3402 20.6279 32.1656 22.3091 32.5C23.9902 32.8344 25.7328 32.6628 27.3164 32.0068C28.9001 31.3508 30.2536 30.24 31.2059 28.8148C32.1582 27.3896 32.6665 25.7139 32.6665 23.9998C32.6665 21.7013 31.7534 19.4969 30.1281 17.8716C28.5028 16.2463 26.2984 15.3332 23.9998 15.3332ZM23.9998 28.3332C23.1428 28.3332 22.305 28.079 21.5924 27.6029C20.8798 27.1267 20.3244 26.4499 19.9964 25.6581C19.6684 24.8663 19.5826 23.995 19.7498 23.1544C19.917 22.3139 20.3297 21.5417 20.9357 20.9357C21.5417 20.3297 22.3139 19.917 23.1545 19.7498C23.995 19.5826 24.8663 19.6684 25.6581 19.9964C26.45 20.3243 27.1267 20.8798 27.6029 21.5924C28.079 22.305 28.3332 23.1428 28.3332 23.9998C28.3332 25.1491 27.8766 26.2513 27.064 27.064C26.2513 27.8766 25.1491 28.3332 23.9998 28.3332Z" fill="#D16526"/>
              </svg>
          </div>

          <!-- Profile Type -->
          <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-2">{{ dominantProfile.profileType }}</h3>
          <p class="text-gray-600 mb-6">{{ dominantProfile.description }}</p>

          <!-- Progress Bar -->
          <div class="w-full max-w-md">
            <div class="flex justify-between text-sm text-gray-500 mb-2">
              <span>{{ dominantProfile.percentage }}% match</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
              <div class="bg-gradient-to-r from-orange-400 to-orange-500 h-3 rounded-full transition-all duration-1000" 
                   [style.width.%]="dominantProfile.percentage"></div>
            </div>
          </div>
        </div>

        <!-- Empty state -->
        <div *ngIf="!isLoadingDominantProfile && !dominantProfile" class="flex flex-col items-center text-center py-8">
          <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4">
            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No coachees yet</h3>
          <p class="text-sm text-gray-500">The dominant profile will appear once you have students to coach</p>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Edit Profile Modal -->
<div *ngIf="showEditModal" class="fixed inset-0 z-50 overflow-y-auto">
  <!-- Modal backdrop -->
  <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" (click)="closeEditModal()"></div>
  <!-- Modal content -->
  <div class="relative min-h-screen flex items-center justify-center p-4">
    <div class="relative bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">

      <!-- Modal header -->
      <div class="sticky top-0 bg-white rounded-t-2xl border-b border-gray-200 px-6 py-4 z-10">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-semibold text-gray-900">Edit Coach Profile</h3>
          <button (click)="closeEditModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Modal body -->
      <div class="p-6">
        <form [formGroup]="editForm" (ngSubmit)="onSaveProfile()">
          <div class="space-y-8">
            
            <!-- Personal Information Section -->
            <div>
              <h4 class="text-lg font-medium text-gray-900 mb-4">Personal Information</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- First Name -->
                <div>
                  <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
                    First Name *
                  </label>
                  <input
                    type="text"
                    id="firstName"
                    formControlName="firstName"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    [class.border-red-500]="editForm.get('firstName')?.touched && editForm.get('firstName')?.errors"
                    placeholder="Enter your first name">
                  <div *ngIf="editForm.get('firstName')?.touched && editForm.get('firstName')?.errors" class="mt-1 text-sm text-red-600">
                    {{ getFieldError('firstName') }}
                  </div>
                </div>

                <!-- Last Name -->
                <div>
                  <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
                    Last Name *
                  </label>
                  <input
                    type="text"
                    id="lastName"
                    formControlName="lastName"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    [class.border-red-500]="editForm.get('lastName')?.touched && editForm.get('lastName')?.errors"
                    placeholder="Enter your last name">
                  <div *ngIf="editForm.get('lastName')?.touched && editForm.get('lastName')?.errors" class="mt-1 text-sm text-red-600">
                    {{ getFieldError('lastName') }}
                  </div>
                </div>

                <!-- Age -->
                <div>
                  <label for="age" class="block text-sm font-medium text-gray-700 mb-2">
                    Age *
                  </label>
                  <input
                    type="number"
                    id="age"
                    formControlName="age"
                    min="18"
                    max="100"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    [class.border-red-500]="editForm.get('age')?.touched && editForm.get('age')?.errors"
                    placeholder="Enter your age">
                  <div *ngIf="editForm.get('age')?.touched && editForm.get('age')?.errors" class="mt-1 text-sm text-red-600">
                    {{ getFieldError('age') }}
                  </div>
                </div>

                <!-- Gender -->
                <div>
                  <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">
                    Gender *
                  </label>
                  <select
                    id="gender"
                    formControlName="gender"
                    class="bg-white w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    [class.border-red-500]="editForm.get('gender')?.touched && editForm.get('gender')?.errors">
                    <option value="" disabled>Select your gender</option>
                    <option *ngFor="let gender of genderOptions" [value]="gender.value">
                      {{ gender.label }}
                    </option>
                  </select>
                  <div *ngIf="editForm.get('gender')?.touched && editForm.get('gender')?.errors" class="mt-1 text-sm text-red-600">
                    {{ getFieldError('gender') }}
                  </div>
                </div>

                <!-- Phone -->
                <div>
                  <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
                    Phone Number
                  </label>
                  <input
                    type="tel"
                    id="phoneNumber"
                    formControlName="phoneNumber"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    placeholder="Enter your phone number">
                </div>

                <!-- Specialization -->
                <div class="text-gray-700">
                  <label for="specialization" class="block text-sm font-medium text-gray-700 mb-2">
                    Specialization
                  </label>
                  <select
                    id="specialization"
                    formControlName="specialization"
                    [ngClass]="{'text-gray-400': !editForm.get('specialization')?.value}"
                    class="cursor-pointer bg-white w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors">
                    <option disabled selected hidden value="">Select a specialization</option>
                    <option value=""></option>
                    <option *ngFor="let spec of specializationOptions" [value]="spec.value">
                      {{ spec.label }}
                    </option>
                  </select>
                </div>

              </div>
            </div>

            <!-- Location Information Section -->
            <div>
              <h4 class="text-lg font-medium text-gray-900 mb-4">Location Information</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- City -->
                <div>
                  <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                    City
                  </label>
                  <input
                    type="text"
                    id="city"
                    formControlName="city"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    placeholder="Enter your city">
                </div>

                <!-- Country -->
                <div>
                  <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                    Country
                  </label>
                  <input
                    type="text"
                    id="country"
                    formControlName="country"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    placeholder="Enter your country">
                </div>

                <!-- Region -->
                <div>
                  <label for="region" class="block text-sm font-medium text-gray-700 mb-2">
                    Region/State
                  </label>
                  <input
                    type="text"
                    id="region"
                    formControlName="region"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    placeholder="Enter your region or state">
                </div>

                <!-- Address -->
                <div>
                  <label for="address" class="block text-sm font-medium text-gray-700 mb-2">
                    Address
                  </label>
                  <input
                    type="text"
                    id="address"
                    formControlName="address"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"
                    placeholder="Enter your full address">
                </div>

              </div>
            </div>

          </div>

          <!-- Form Actions -->
          <div class="mt-8 flex flex-col-reverse sm:flex-row justify-end gap-3">
            <button
              type="button"
              (click)="closeEditModal()"
              class="w-full sm:w-auto px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors focus:ring-2 focus:ring-orange-500">
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="isUpdating || editForm.invalid"
              class="w-full sm:w-auto px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:ring-2 focus:ring-orange-500 flex items-center justify-center gap-2">
              <span *ngIf="isUpdating" class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></span>
              {{ isUpdating ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Expertise Management Modal -->
<div *ngIf="showExpertiseModal" class="fixed inset-0 z-50 overflow-y-auto">
  <!-- Modal backdrop -->
  <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" (click)="closeExpertiseModal()"></div>
  <!-- Modal content -->
  <div class="relative min-h-screen flex items-center justify-center p-4">
    <div class="relative bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">

      <!-- Modal header -->
      <div class="sticky top-0 bg-white rounded-t-2xl border-b border-gray-200 px-6 py-4 z-10">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-semibold text-gray-900">{{ hasExpertiseData ? 'Edit' : 'Add' }} Coaching Expertise</h3>
          <button (click)="closeExpertiseModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Modal body -->
      <div class="p-6">
        <form [formGroup]="expertiseForm" (ngSubmit)="onSaveExpertise()">
          <div class="space-y-6">
            
            <!-- Specialization -->
            <div>
              <label for="modalCoachSpecialization" class="block text-sm font-medium text-gray-700 mb-2">
                Primary Specialization
              </label>
              <select
                id="modalCoachSpecialization"
                formControlName="specialization"
                class="bg-white w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors">
                <option value="">Select a specialization</option>
                <option *ngFor="let spec of specializationOptions" [value]="spec.value">
                  {{ spec.label }}
                </option>
              </select>
            </div>

            <!-- Expertise -->
            <div>
              <label for="expertise" class="block text-sm font-medium text-gray-700 mb-2">
                Expertise Areas
              </label>
              <textarea
                id="expertise"
                formControlName="expertise"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors resize-none"
                placeholder="e.g., Career Development, Personal Growth, Goal Setting"></textarea>
              <p class="mt-1 text-xs text-gray-500">Separate multiple areas with commas</p>
            </div>

            <!-- Services -->
            <div>
              <label for="services" class="block text-sm font-medium text-gray-700 mb-2">
                Services Offered
              </label>
              <textarea
                id="services"
                formControlName="services"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors resize-none"
                placeholder="e.g., Available for 1-on-1 sessions, Group coaching, Workshop facilitation"></textarea>
            </div>

            <!-- Availability -->
            <div>
              <label for="availability" class="block text-sm font-medium text-gray-700 mb-2">
                Availability
              </label>
              <textarea
                id="availability"
                formControlName="availability"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors resize-none"
                placeholder="e.g., Monday - Friday: 9 AM - 6 PM&#10;Weekend: By appointment"></textarea>
              <p class="mt-1 text-xs text-gray-500">Press Enter for new lines</p>
            </div>

          </div>

          <!-- Form Actions -->
          <div class="mt-8 flex flex-col-reverse sm:flex-row justify-end gap-3">
            <button
              type="button"
              (click)="closeExpertiseModal()"
              class="w-full sm:w-auto px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors focus:ring-2 focus:ring-orange-500">
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="isUpdating"
              class="w-full sm:w-auto px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:ring-2 focus:ring-orange-500 flex items-center justify-center gap-2">
              <span *ngIf="isUpdating" class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></span>
              {{ isUpdating ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>