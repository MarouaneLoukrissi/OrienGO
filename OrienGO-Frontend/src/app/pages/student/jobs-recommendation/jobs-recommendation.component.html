<div class="min-h-screen bg-orange-50">
  <!-- Header -->
  <header class="border-b border-gray-100">
    <div class="max-w-[88rem] mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="text-center">
        <!-- Lightbulb Icon -->
        <div class="w-20 h-20 sm:w-[86px] sm:h-[86px] md:w-24 md:h-24 inline-flex items-center justify-center bg-orange-500 rounded-full mb-4">
          <svg class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 sm:h-16 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.5" d="M2.80408 15.4771C2.80408 15.4771 2.94608 17.2151 2.97908 17.7631C3.02308 18.4981 3.30708 19.3191 3.78108 19.8891C4.45008 20.6971 5.23808 20.9821 6.29008 20.9841C7.52708 20.9861 16.5221 20.9861 17.7591 20.9841C18.8111 20.9821 19.5991 20.6971 20.2681 19.8891C20.7421 19.3191 21.0261 18.4981 21.0711 17.7631C21.1031 17.2151 21.2451 15.4771 21.2451 15.4771" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8.49597 5.32949V4.95849C8.49597 3.73849 9.48397 2.75049 10.704 2.75049H13.286C14.505 2.75049 15.494 3.73849 15.494 4.95849L15.495 5.32949" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M11.995 16.6783V15.3843" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M2.74988 8.38905V11.8561C4.66788 13.1211 6.96588 14.0071 9.48788 14.3581C9.78988 13.2571 10.7829 12.4501 11.9899 12.4501C13.1779 12.4501 14.1909 13.2571 14.4729 14.3681C17.0049 14.0171 19.3119 13.1311 21.2399 11.8561V8.38905C21.2399 6.69505 19.8769 5.33105 18.1829 5.33105H5.81688C4.12288 5.33105 2.74988 6.69505 2.74988 8.38905Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
        </div>
        <h1 class="text-sm xxs:text-base xs:text-xl smaller:text-2xl sm:text-4xl font-bold text-gray-800 mb-4">
          Personalized Job Recommendations
        </h1>
        <p class="text-gray-600 text-base sm:text-lg mb-8 max-w-xl sm:max-w-2xl mx-auto sm:px-0">
          Jobs tailored specifically for your profile and preferences
          <span *ngIf="!isOwner" class="block text-sm text-blue-600 mt-2 font-medium">
            üëÅÔ∏è Coach View - Viewing as read-only
          </span>
        </p>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-20">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"></div>
    <span class="ml-4 text-gray-600">Loading your personalized jobs...</span>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="max-w-md mx-auto text-center py-20">
    <svg class="w-16 h-16 mx-auto text-red-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    <h3 class="text-lg font-semibold text-gray-900 mb-2">Oops! Something went wrong</h3>
    <p class="text-gray-600 mb-4">{{ error }}</p>
    <button (click)="retryLoad()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
      Try Again
    </button>
  </div>

  <!-- Main Content -->
  <main *ngIf="!isLoading && !error" class="max-w-[88rem] mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search and Filters -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-100 p-3 xxs:p-6 mb-8">
      <div class="flex flex-col md:flex-wrap md:flex-row gap-4">
        <!-- Search Input -->
        <div class="flex-1 relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <input
            type="text"
            placeholder="Search jobs, companies, or skills..."
            [(ngModel)]="filters.searchTerm"
            (ngModelChange)="onFiltersChange()"
            class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all text-gray-700 placeholder-gray-500"
          />
        </div>

        <!-- Sector Filter -->
        <div class="relative">
          <select
            [(ngModel)]="filters.sector"
            (ngModelChange)="onFiltersChange()"
            class="text-xs xxs:text-sm xs:text-base appearance-none bg-white border border-gray-200 rounded-xl px-1 py-1 xxs:px-2 xxs:py-2 xs:px-4 xs:py-3 xs:pr-10 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-700 cursor-pointer min-w-full md:min-w-[140px]">
            <option value="">All Sectors</option>
            <option value="education">Education</option>
            <option value="healthcare">Healthcare</option>
            <option value="technology">Technology</option>
            <option value="finance">Finance</option>
            <option value="marketing">Marketing</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-1 xs:pr-3 pointer-events-none">
            <svg class="h-3 w-3 xxs:h-4 xxs:w-4 xs:h-5 xs:w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>

        <!-- Level Filter -->
        <div class="relative">
          <select
            [(ngModel)]="filters.level"
            (ngModelChange)="onFiltersChange()"
            class="text-xs xxs:text-sm xs:text-base appearance-none bg-white border border-gray-200 rounded-xl px-1 py-1 xxs:px-2 xxs:py-2 xs:px-4 xs:py-3 xs:pr-10 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-700 cursor-pointer min-w-full md:min-w-[130px]">
            <option value="">All Levels</option>
            <option value="entry">Entry Level</option>
            <option value="mid">Mid Level</option>
            <option value="senior">Senior Level</option>
            <option value="executive">Executive</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-1 xs:pr-3 pointer-events-none">
            <svg class="h-3 w-3 xxs:h-4 xxs:w-4 xs:h-5 xs:w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
      <div class="mb-4 sm:mb-0">
        <h2 class="text-xl font-semibold text-gray-900 pl-3">
          {{ filteredJobs.length }} jobs found
          <span class="text-gray-500 text-sm font-normal ml-2">(Page {{ currentPage }} of {{ totalPages }})</span>
        </h2>
      </div>
      <div class="flex items-center text-sm text-gray-600 pl-3 sm:pr-3">
        <svg class="w-4 h-4 shrink-0 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M19 3H5C3.58579 3 2.87868 3 2.43934 3.4122C2 3.8244 2 4.48782 2 5.81466V6.50448C2 7.54232 2 8.06124 2.2596 8.49142C2.5192 8.9216 2.99347 9.18858 3.94202 9.72255L6.85504 11.3624C7.49146 11.7206 7.80967 11.8998 8.03751 12.0976C8.51199 12.5095 8.80408 12.9935 8.93644 13.5872C9 13.8722 9 14.2058 9 14.8729L9 17.5424C9 18.452 9 18.9067 9.25192 19.2613C9.50385 19.6158 9.95128 19.7907 10.8462 20.1406C12.7248 20.875 13.6641 21.2422 14.3321 20.8244C15 20.4066 15 19.4519 15 17.5424V14.8729C15 14.2058 15 13.8722 15.0636 13.5872C15.1959 12.9935 15.488 12.5095 15.9625 12.0976C16.1903 11.8998 16.5085 11.7206 17.145 11.3624L20.058 9.72255C21.0065 9.18858 21.4808 8.9216 21.7404 8.49142C22 8.06124 22 7.54232 22 6.50448V5.81466C22 4.48782 22 3.8244 21.5607 3.4122C21.1213 3 20.4142 3 19 3Z" stroke="currentColor" stroke-width="2"></path> </g></svg>
        Filtered by your profile
      </div>
    </div>

    <!-- Job Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <div
        *ngFor="let job of paginatedJobs; trackBy: trackByJobId"
        class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-100 p-3 xxs:p-6 hover:shadow-lg transition-all duration-300 group">

        <!-- Header -->
        <div class="flex items-start flex-col xs:flex-row justify-between mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2 flex-wrap">
              <h3 class="text-base xxs:text-lg font-semibold text-gray-900 group-hover:text-orange-600 transition-colors">
                {{ job.title }}
              </h3>
              <!-- Commented out match percentage as requested -->
              <!-- <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap">
                {{ job.matchPercentage }}% match
              </span> -->
            </div>
            <p class="text-sm xxs:text-base text-gray-600 font-medium mb-1">{{ job.company }}</p>
            <div class="flex items-center text-gray-500 text-sm">
              <svg class="w-4 h-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
              </svg>
              {{ job.location }}
            </div>
          </div>
          <div class="flex flex-row xs:flex-col smaller:flex-row justify-center items-center gap-3 xs:gap-2 xs:ml-4 flex-shrink-0">
            <button
              *ngIf="canPerformActions()"
              class="mt-1 xs:mt-0 p-2 rounded-full hover:bg-gray-100 transition-colors"
              [class.text-red-500]="job.isFavorite"
              [class.text-gray-400]="!job.isFavorite"
              (click)="toggleFavorite(job)"
              [title]="job.isFavorite ? 'Remove from favorites' : 'Add to favorites'">
              <svg [attr.stroke]="job.isFavorite ? 'none' : '#9BA3AF'" class="w-5 h-5" viewBox="0 0 18 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M9 2.50019C7.35055 0.577926 4.59429 -0.0161379 2.52763 1.74408C0.460956 3.5043 0.169997 6.44728 1.79296 8.52912C3.14235 10.26 7.22607 13.9106 8.56449 15.0922C8.71418 15.2244 8.78907 15.2905 8.87643 15.3164C8.95261 15.339 9.03602 15.339 9.11229 15.3164C9.19965 15.2905 9.27445 15.2244 9.42423 15.0922C10.7627 13.9106 14.8463 10.26 16.1957 8.52912C17.8187 6.44728 17.5632 3.48579 15.461 1.74408C13.3588 0.00237875 10.6494 0.577926 9 2.50019Z" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <!-- Read-only heart icon for coaches -->
            <div
              *ngIf="!canPerformActions()"
              class="mt-1 xs:mt-0 p-2 rounded-full cursor-not-allowed"
              [class.text-red-500]="job.isFavorite"
              [class.text-gray-300]="!job.isFavorite"
              [title]="job.isFavorite ? 'Favorited by student' : 'Not favorited'">
              <svg [attr.stroke]="job.isFavorite ? 'none' : '#9BA3AF'" class="w-5 h-5" viewBox="0 0 18 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M9 2.50019C7.35055 0.577926 4.59429 -0.0161379 2.52763 1.74408C0.460956 3.5043 0.169997 6.44728 1.79296 8.52912C3.14235 10.26 7.22607 13.9106 8.56449 15.0922C8.71418 15.2244 8.78907 15.2905 8.87643 15.3164C8.95261 15.339 9.03602 15.339 9.11229 15.3164C9.19965 15.2905 9.27445 15.2244 9.42423 15.0922C10.7627 13.9106 14.8463 10.26 16.1957 8.52912C17.8187 6.44728 17.5632 3.48579 15.461 1.74408C13.3588 0.00237875 10.6494 0.577926 9 2.50019Z" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>

        <p class="text-gray-600 text-sm break-words xxs:text-base mb-4 leading-relaxed">{{ job.description | slice:0:120 }}{{ job.description.length > 120 ? '...' : '' }}</p>

        <!-- Job Details -->
        <div class="flex flex-wrap items-center gap-4 mb-4 text-sm">
          <div class="flex items-center text-gray-600">
            <span class="font-medium">‚Ç¨ {{ job.salaryRange }}</span>
          </div>
          <div class="flex items-center text-gray-500">
            <svg class="w-4 h-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            {{ job.experience }} experience
          </div>
        </div>

        <!-- Employment Type & Demand -->
        <div class="flex flex-wrap items-center gap-2 mb-4">
          <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs xxs:text-sm font-medium">
            {{ job.employmentType }}
          </span>
          <span
            class="px-3 py-1 rounded-full text-xs xxs:text-sm font-medium"
            [ngClass]="{
              'bg-green-100 text-green-700': job.demandLevel === 'stable',
              'bg-blue-100 text-blue-700': job.demandLevel === 'high',
              'bg-emerald-100 text-emerald-700': job.demandLevel === 'very-high'
            }">
            {{ getDemandText(job.demandLevel) }}
          </span>
          <!-- Show saved/favorite status indicators for coaches -->
          <span
            *ngIf="!isOwner && job.isSaved"
            class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium flex items-center gap-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
            </svg>
            Saved
          </span>
          <span
            *ngIf="!isOwner && job.isFavorite"
            class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium flex items-center gap-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
            </svg>
            Favorite
          </span>
        </div>

        <!-- Required Skills -->
        <div class="mb-4" *ngIf="job.requiredSkills.length > 0">
          <h4 class="text-sm font-semibold text-gray-900 mb-2">Required Skills</h4>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let skill of job.requiredSkills.slice(0, 3)"
              class="truncate xxs:whitespace-normal xxs:overflow-visible xxs:text-clip px-3 py-1 bg-orange-50 text-orange-700 rounded-lg text-sm border border-orange-200">
              {{ skill }}
            </span>
            <span *ngIf="job.requiredSkills.length > 3" class="px-3 py-1 bg-gray-100 text-gray-500 rounded-lg text-sm">
              +{{ job.requiredSkills.length - 3 }} more
            </span>
          </div>
        </div>

        <!-- Advantages -->
        <div class="mb-6" *ngIf="job.advantages.length > 0">
          <h4 class="text-sm font-semibold text-gray-900 mb-2">Advantages</h4>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let advantage of job.advantages.slice(0, 2)"
              class="truncate xxs:whitespace-normal xxs:overflow-visible xxs:text-clip px-3 py-1 bg-green-50 text-green-700 rounded-lg text-sm border border-green-200">
              {{ advantage }}
            </span>
            <span *ngIf="job.advantages.length > 2" class="px-3 py-1 bg-gray-100 text-gray-500 rounded-lg text-sm">
              +{{ job.advantages.length - 2 }} more
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3">
          <button
            class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-xl font-semibold transition-colors focus:outline-none"
            (click)="viewDetails(job)">
            {{ job.applyUrl ? 'Apply Now' : 'View Details' }}
          </button>
          <button
            class="sm:flex-shrink-0 px-6 py-3 border border-blue-500 text-blue-500 hover:bg-blue-50 rounded-xl font-semibold transition-colors focus:outline-none"
            (click)="openJobModal(job)">
            View More
          </button>
          <button
            *ngIf="canPerformActions()"
            class="sm:flex-shrink-0 px-6 py-3 border-2 transition-colors focus:outline-none rounded-xl font-semibold"
            [class.border-orange-500]="!job.isSaved"
            [class.text-orange-500]="!job.isSaved"
            [class.hover:bg-orange-50]="!job.isSaved"
            [class.border-green-500]="job.isSaved"
            [class.text-green-600]="job.isSaved"
            [class.bg-green-50]="job.isSaved"
            [class.hover:bg-green-100]="job.isSaved"
            (click)="saveJobToggle(job)">
            {{ job.isSaved ? 'Saved ‚úì' : 'Save' }}
          </button>
          <!-- Read-only saved indicator for coaches -->
          <div
            *ngIf="!canPerformActions()"
            class="sm:flex-shrink-0 px-6 py-3 border-2 rounded-xl font-semibold cursor-not-allowed"
            [class.border-green-300]="job.isSaved"
            [class.text-green-500]="job.isSaved"
            [class.bg-green-50]="job.isSaved"
            [class.border-gray-300]="!job.isSaved"
            [class.text-gray-400]="!job.isSaved"
            [class.bg-gray-50]="!job.isSaved">
            {{ job.isSaved ? 'Saved ‚úì' : 'Not Saved' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div *ngIf="totalPages > 1" class="flex flex-col sm:flex-row items-center justify-between mb-8 gap-4">
      <!-- Previous Button -->
      <button
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Previous
      </button>

      <!-- Page Numbers -->
      <div class="flex items-center space-x-2">
        <button
          *ngFor="let page of getPaginationArray()"
          (click)="goToPage(page)"
          [class]="page === currentPage ?
            'bg-orange-500 text-white' :
            'bg-white text-gray-600 hover:bg-gray-50'"
          class="px-3 py-2 border border-gray-300 rounded-lg transition-colors">
          {{ page }}
        </button>
      </div>

      <!-- Next Button -->
      <button
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
        Next
        <svg class="w-5 h-5 inline ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredJobs.length === 0 && jobs.length > 0" class="text-center pt-16 pb-20">
      <div class="max-w-md mx-auto">
        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">No jobs found</h3>
        <p class="text-gray-600 mb-4">Try adjusting your filters to see more results</p>
        <button
          (click)="clearFilters()"
          class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
          Clear filters
        </button>
      </div>
    </div>

    <!-- No Data State -->
    <div *ngIf="filteredJobs.length === 0 && jobs.length === 0" class="text-center pt-16 pb-20">
      <div class="max-w-md mx-auto">
        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
        </svg>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">No personalized jobs available</h3>
        <p class="text-gray-600 mb-4">We couldn't find any personalized job recommendations for you at the moment.</p>
        <button
          (click)="retryLoad()"
          class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
          Try Again
        </button>
      </div>
    </div>

    <!-- Back Button -->
    <div class="text-center">
      <button (click)="goBack()" class="max-w-full text-sm xs:text-base bg-white inline-flex items-center px-6 py-3 border-2 border-orange-500 text-orange-500 hover:bg-orange-50 rounded-xl font-semibold transition-colors focus:outline-none">
        <svg class="w-5 h-5 mr-2 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        <span class="truncate block">
          Back to Recommendations
        </span>
      </button>
    </div>
  </main>

  <!-- Job Details Modal -->
  <div *ngIf="showJobModal && selectedJob" class="fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <!-- Modal Header -->
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <div class="flex items-center gap-3">
          <h2 class="text-xl font-bold text-gray-900">{{ selectedJob.title }}</h2>
          <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-medium">
            {{ selectedJob.matchPercentage }}% match
          </span>
          <!-- Status indicators in modal header -->
          <div class="flex items-center gap-2">
            <span
              *ngIf="selectedJob.isSaved"
              class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
              </svg>
              Saved
            </span>
            <span
              *ngIf="selectedJob.isFavorite"
              class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
              </svg>
              Favorite
            </span>
          </div>
        </div>
        <button (click)="closeJobModal()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="px-6 py-6 space-y-6">
        <!-- Company Info -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Company Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-600">Company:</span>
              <span class="ml-2">{{ selectedJob.company }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-600">Location:</span>
              <span class="ml-2">{{ selectedJob.location }}</span>
            </div>
            <div *ngIf="selectedJob.companyIndustry">
              <span class="font-medium text-gray-600">Industry:</span>
              <span class="ml-2">{{ selectedJob.companyIndustry }}</span>
            </div>
            <div *ngIf="selectedJob.companyNumEmployees">
              <span class="font-medium text-gray-600">Employees:</span>
              <span class="ml-2">{{ selectedJob.companyNumEmployees }}</span>
            </div>
            <div *ngIf="selectedJob.companyRevenue">
              <span class="font-medium text-gray-600">Revenue:</span>
              <span class="ml-2">{{ selectedJob.companyRevenue }}</span>
            </div>
            <div *ngIf="selectedJob.isRemote !== undefined">
              <span class="font-medium text-gray-600">Remote:</span>
              <span class="ml-2">{{ selectedJob.isRemote ? 'Yes' : 'No' }}</span>
            </div>
          </div>
        </div>

        <!-- Job Description -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Job Description</h3>
          <div class="bg-white border border-gray-200 rounded-lg p-4">
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ selectedJob.description }}</p>
          </div>
        </div>

        <!-- Company Description -->
        <div *ngIf="selectedJob.companyDescription">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">About the Company</h3>
          <div class="bg-white border border-gray-200 rounded-lg p-4">
            <p class="text-gray-700 leading-relaxed">{{ selectedJob.companyDescription }}</p>
          </div>
        </div>

        <!-- Job Details -->
        <div class="bg-blue-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Job Details</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-600">Salary:</span>
              <span class="ml-2">‚Ç¨ {{ selectedJob.salaryRange }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-600">Experience:</span>
              <span class="ml-2">{{ selectedJob.experience }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-600">Employment Type:</span>
              <span class="ml-2">{{ selectedJob.employmentType }}</span>
            </div>
            <div *ngIf="selectedJob.duration">
              <span class="font-medium text-gray-600">Duration:</span>
              <span class="ml-2">{{ selectedJob.duration }}</span>
            </div>
            <div *ngIf="selectedJob.category">
              <span class="font-medium text-gray-600">Category:</span>
              <span class="ml-2">{{ selectedJob.category }}</span>
            </div>
            <div *ngIf="selectedJob.source">
              <span class="font-medium text-gray-600">Source:</span>
              <span class="ml-2">{{ selectedJob.source }}</span>
            </div>
            <div *ngIf="selectedJob.postedDate">
              <span class="font-medium text-gray-600">Posted:</span>
              <span class="ml-2">{{ formatDate(selectedJob.postedDate) }}</span>
            </div>
            <div *ngIf="selectedJob.expirationDate">
              <span class="font-medium text-gray-600">Expires:</span>
              <span class="ml-2">{{ formatDate(selectedJob.expirationDate) }}</span>
            </div>
          </div>
        </div>

        <!-- Required Skills -->
        <div *ngIf="selectedJob.requiredSkills.length > 0">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Required Skills</h3>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let skill of selectedJob.requiredSkills"
              class="px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-sm border border-orange-200 font-medium">
              {{ skill }}
            </span>
          </div>
        </div>

        <!-- Advantages -->
        <div *ngIf="selectedJob.advantages.length > 0">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Job Benefits</h3>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let advantage of selectedJob.advantages"
              class="px-3 py-2 bg-green-50 text-green-700 rounded-lg text-sm border border-green-200 font-medium">
              {{ advantage }}
            </span>
          </div>
        </div>

        <!-- Company Addresses -->
        <div *ngIf="selectedJob.companyAddresses">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Company Locations</h3>
          <div class="space-y-2">
            <div
              *ngFor="let address of parseAddresses(selectedJob.companyAddresses)"
              class="flex items-center text-gray-700">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
              </svg>
              {{ address }}
            </div>
          </div>
        </div>

        <!-- Contact Information -->
        <div *ngIf="selectedJob.emails">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">Contact Information</h3>
          <div class="space-y-2">
            <div
              *ngFor="let email of parseEmails(selectedJob.emails)"
              class="flex items-center">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
              </svg>
              <a href="mailto:{{ email }}" class="text-blue-600 hover:text-blue-800">{{ email }}</a>
            </div>
          </div>
        </div>

        <!-- Additional Links -->
        <div class="space-y-2">
          <div *ngIf="selectedJob.companyUrl" class="flex items-center">
            <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.559-.499-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.559.499.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.497-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.147.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z" clip-rule="evenodd"/>
            </svg>
            <a href="{{ selectedJob.companyUrl }}" target="_blank" class="text-blue-600 hover:text-blue-800">
              Company Website
            </a>
          </div>
          <div *ngIf="selectedJob.jobUrlDirect" class="flex items-center">
            <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/>
            </svg>
            <a href="{{ selectedJob.jobUrlDirect }}" target="_blank" class="text-blue-600 hover:text-blue-800">
              Original Job Posting
            </a>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
          <button
            class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-xl font-semibold transition-colors focus:outline-none"
            (click)="viewDetails(selectedJob)">
            {{ selectedJob.applyUrl ? 'Apply Now' : 'View Details' }}
          </button>

          <!-- Save button for owners -->
          <button
            *ngIf="canPerformActions()"
            class="sm:flex-shrink-0 px-6 py-3 border-2 transition-colors focus:outline-none rounded-xl font-semibold"
            [class.border-orange-500]="!selectedJob.isSaved"
            [class.text-orange-500]="!selectedJob.isSaved"
            [class.hover:bg-orange-50]="!selectedJob.isSaved"
            [class.border-green-500]="selectedJob.isSaved"
            [class.text-green-600]="selectedJob.isSaved"
            [class.bg-green-50]="selectedJob.isSaved"
            [class.hover:bg-green-100]="selectedJob.isSaved"
            (click)="saveJobToggle(selectedJob)">
            {{ selectedJob.isSaved ? 'Saved ‚úì' : 'Save Job' }}
          </button>

          <!-- Favorite button for owners -->
          <button
            *ngIf="canPerformActions()"
            class="sm:flex-shrink-0 px-6 py-3 border-2 transition-colors focus:outline-none rounded-xl font-semibold"
            [class.border-gray-300]="!selectedJob.isFavorite"
            [class.text-gray-600]="!selectedJob.isFavorite"
            [class.hover:bg-gray-50]="!selectedJob.isFavorite"
            [class.border-red-500]="selectedJob.isFavorite"
            [class.text-red-600]="selectedJob.isFavorite"
            [class.bg-red-50]="selectedJob.isFavorite"
            [class.hover:bg-red-100]="selectedJob.isFavorite"
            (click)="toggleFavorite(selectedJob)">
            {{ selectedJob.isFavorite ? 'Favorited ‚ô•' : 'Add to Favorites' }}
          </button>

          <!-- Read-only status for coaches -->
          <div *ngIf="!canPerformActions()" class="sm:flex-shrink-0 px-6 py-3 border border-gray-200 text-gray-500 rounded-xl font-medium bg-gray-50">
            Coach View - Read Only
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
